{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/books/build-systems","result":{"data":{"markdownRemark":{"html":"<h2 id=\"make\" style=\"position:relative;\"><a href=\"#make\" aria-label=\"make permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Make:</h2>\n<p>Создается Makefile:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">util.o: util.h util.c\n\tgcc -c util.c\nmain.o: util.h main.c\n\tgcc -c main.c\nmain.exe: util.o main.o\n\tgcc util.o main.o -o main.exe</code></pre></div>\n<p>Если граф ацикличный, то каждый таск должен быть выполнен 0-1 раз.\nЦикличные графы обычно не поддерживаются билд-системами.</p>\n<p>Make: </p>\n<ul>\n<li>использует время модификации файла</li>\n<li>создает граф зависимостей тасков и запускает их в топологическом порядке</li>\n</ul>\n<p>Такой подход удовлетворяет свойству минимальности:\nбилд-система является <em>минимальной</em>, если она выполняет такси не больше одного раза в процессе билда и только если они транзитивно зависят от инпутов, которые изменены со времени прошлого билда.</p>\n<h2 id=\"excel\" style=\"position:relative;\"><a href=\"#excel\" aria-label=\"excel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Excel</h2>\n<p>Может быть рассмотрен как билд-система с динамическими меняющимися зависимостями.</p>\n<p>Пример:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\tA1: 10 B1: INDIRECT(&quot;A&quot; &amp; C1) C1: 1\n\tA2: 20</code></pre></div>\n<p>Так как значение B1 определяется значением C1, то невозможно построить граф зависимостей до начала билда.</p>\n<p>Чтобы поддерживать динамические зависимости, используется <strong>calc chain</strong>:</p>\n<p>ячейки обрабатываются в последовательности <strong>calc-chain</strong>, но если вычисление ячейки C требует значения ячейки D, которая еще не вычислена, то Excel <em>прекращает</em> вычисление C, перемещает D вперед C в <strong>calc-chain</strong> и возобновляет билд, начиная с D.</p>\n<p>Когда значения или формулы меняются, то Excel использует финальную <strong>calc-chain</strong> из предыдущего билда и начинает с нее.</p>\n<p>Такой подход не удовлетворяет свойству <em>минимальности</em>. B1 должен быть перевычислен только если изменяются A1 или C1, но это не очевидно. Excel использует \"приблизительную\" минимальность:\nформула пересчитывается, если:\n- упоминает изменившуюся ячейку\n- использует INDIRECT, чьи зависимости не видны статически\n- ячейка изменилась сама</p>\n<p>То есть в нашем случае B1 будет пересчитываться всегда, а это явное нарушение минимальности.</p>\n<h2 id=\"shake\" style=\"position:relative;\"><a href=\"#shake\" aria-label=\"shake permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Shake</h2>\n<p>Попытка удовлетворить свойству минимальности при решении проблемы динамических зависимостей.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/hows-that-again/static/b88e5b526482f00e2c46c6e409ab7802/dd45a/build-systems-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.717791411042946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABBElEQVQoz3VS2YqEQAz0/z/NF19UPPBEBe9bvDNU2Ayz7mwgdLpDKlVFK/QT933TM87zpHVdqes6KsuSkiShNE2pqioax5GO4/gzowBIwIZhoDzPqSgKatuWlmWhbdvePYBlWcZLruviftM0/BbHMd9/AWKzrutkGAYz+IwgCLhnWRazlajrmlzXJdM0eakicvd9ZxAwmqaJ5nnmN8hCDcbSgwVgA5ZfJSM8zyNN01gOpKmqytIBats2J+yIoohZ+r7PHiMALEoZECCQi8193/MJb/AGhhhEYhAptZARsDeg4zjsETzA9jAM2Sd4BrbffsB/v0MR/5DYLL6hxon8ZPDMJ+gLtElp3WgQ42oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Shake example\"\n        title=\"Shake example\"\n        src=\"/hows-that-again/static/b88e5b526482f00e2c46c6e409ab7802/dd45a/build-systems-1.png\"\n        srcset=\"/hows-that-again/static/b88e5b526482f00e2c46c6e409ab7802/222b7/build-systems-1.png 163w,\n/hows-that-again/static/b88e5b526482f00e2c46c6e409ab7802/ff46a/build-systems-1.png 325w,\n/hows-that-again/static/b88e5b526482f00e2c46c6e409ab7802/dd45a/build-systems-1.png 550w\"\n        sizes=\"(max-width: 550px) 100vw, 550px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Содержимое <code class=\"language-text\">release.tar</code> определяется содержимым <code class=\"language-text\">release.txt</code>. Makefile так не может и приходится использовать костыли типа <em>build phases</em>.</p>\n<p>В Shake можно указать правило для <code class=\"language-text\">release.tar</code> так:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;release.tar&quot; %&gt; \\_ -&gt; do\n\tneed [&quot;release.txt&quot;]\n\tfiles &lt;- lines &lt;$&gt; readFile &quot;release.txt&quot;\n\tneed files\n\tsystem &quot;tar&quot; $ [&quot;-cf&quot;, &quot;release.tar&quot;] ++ files</code></pre></div>\n<p>Отличия от Make и Excel:\n- Shake использует граф зависимости из предыдущего билда, чтобы определить, какие файлы должны быть перебилжены.\n- вместо <em>прекращения</em> выполнения тасков, чьи зависимости пока не построены (как делает Excel), они приостанавливаются (suspend).\n- поддерживается <em>early cutoff optimization</em>. Когда выполняется таск и результат не изменился относительно предыдущего билда, зависимые таски можно не выполнять. Make и Excel так не умеют.</p>\n<h2 id=\"bazel\" style=\"position:relative;\"><a href=\"#bazel\" aria-label=\"bazel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bazel</h2>\n<p>Облачная файловая система. Результаты билдов шарятся между членами команды. Локально появляются только конечные результаты, а все промежуточные остаются в облаке.</p>\n<p>Пример (в кружках - хэши от содержания):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/hows-that-again/static/206e505a4defec8245793dd12b00cfdb/f73a1/build-systems-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.766871165644172%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAA6UlEQVQY011QyY7DIBTL/39Zbz3k0GmaCWFt9p1sSuIB2lTVPMkCzLPxwzuOA/9ha993zPOMcRwRhiG01o631/u2YVlX+AFFJLI3/9J634dzb2szomEYEMexA+f83ffqYVzieiPw7xGmafpovdPg2+xM2HUdGGMuJSEEeZ5jXRboccLFjyDTEkowUErRNI3r86qqQpZlaNsWQgj0fe9M7IjWpK5rBEGAsizxeAQmtQb/uSKnd/xGBEpJp1NKuSCe/ScppSNOpGlqEh6wjyXJE4Irk641KLCbKZqE4klu5hssX5uVoSgKZ/gHg0p9Kq+CnfMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Bazel example\"\n        title=\"Bazel example\"\n        src=\"/hows-that-again/static/206e505a4defec8245793dd12b00cfdb/a6d36/build-systems-2.png\"\n        srcset=\"/hows-that-again/static/206e505a4defec8245793dd12b00cfdb/222b7/build-systems-2.png 163w,\n/hows-that-again/static/206e505a4defec8245793dd12b00cfdb/ff46a/build-systems-2.png 325w,\n/hows-that-again/static/206e505a4defec8245793dd12b00cfdb/a6d36/build-systems-2.png 650w,\n/hows-that-again/static/206e505a4defec8245793dd12b00cfdb/f73a1/build-systems-2.png 822w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"сравнение-систем\" style=\"position:relative;\"><a href=\"#%D1%81%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC\" aria-label=\"сравнение систем permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Сравнение систем</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/hows-that-again/static/6d5478f239d31fd1b5c1d8b8f171fc9c/2ad15/build-systems-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.404907975460123%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAAzUlEQVQY0yWQ2w6EIAxE/f/P80G5CV4eRFdjdMXsanS27ZI0hVLmTMmstQh1DaVKaGNQliUMZaUUaqoPwwittdT4rLVCVXm0bUu5kjdN08A5C9bKYozgZYxGURQSLOqcw3leOI5DYHmew4cARXd93+O+byzLghgHbNuGcRwRqZ71JPg8jzgI3ouLirInOjuZ51mcML3rOtlznNeF/f3GNM3Y1lUmYVCWUsL3+8GLCNzo/X8cFrAEkS8JNUWguyBQL+Dm30uQnTR4kpR2/AAREiSrXNpiQwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Build systems comparison\"\n        title=\"Build systems comparison\"\n        src=\"/hows-that-again/static/6d5478f239d31fd1b5c1d8b8f171fc9c/a6d36/build-systems-3.png\"\n        srcset=\"/hows-that-again/static/6d5478f239d31fd1b5c1d8b8f171fc9c/222b7/build-systems-3.png 163w,\n/hows-that-again/static/6d5478f239d31fd1b5c1d8b8f171fc9c/ff46a/build-systems-3.png 325w,\n/hows-that-again/static/6d5478f239d31fd1b5c1d8b8f171fc9c/a6d36/build-systems-3.png 650w,\n/hows-that-again/static/6d5478f239d31fd1b5c1d8b8f171fc9c/2ad15/build-systems-3.png 801w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","frontmatter":{"path":"/blog/books/build-systems","title":"build-systems"}}},"pageContext":{}},"staticQueryHashes":["3649515864"]}