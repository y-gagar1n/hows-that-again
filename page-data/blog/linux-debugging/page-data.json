{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/linux-debugging","webpackCompilationHash":"b32de601192887675132","result":{"data":{"markdownRemark":{"html":"<h1>strace</h1>\n<p>Выводит все системные вызовы программы. Пример запуска:</p>\n<p><code class=\"language-text\">strace ls</code></p>\n<p>Выводит кучу строк следующего вида:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">execve(&quot;/bin/ls&quot;, [&quot;ls&quot;], [/* 93 vars */]) = 0                 \nbrk(NULL)                               = 0x558f2b6db000                                       \naccess(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)\nmmap(NULL, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f1ce7ad9000\naccess(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)           \nopen(&quot;/usr/local/cuda/lib64/tls/x86_64/libselinux.so.1&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)</code></pre></div>\n<p>Разберем первую строку по частям:</p>\n<ul>\n<li><code class=\"language-text\">execve</code> - системный вызов</li>\n<li><code class=\"language-text\">(&quot;/bin/ls&quot;, [&quot;ls&quot;], [/* 93 vars */])</code> - аргументы вызова</li>\n<li><code class=\"language-text\">= 0</code> - возвращаемое значение</li>\n</ul>\n<h2>Флаги</h2>\n<ul>\n<li><code class=\"language-text\">-e</code> - ограничить показываемые системные вызовы, например, <code class=\"language-text\">strace -e open</code></li>\n<li><code class=\"language-text\">-f</code> - (follow) - если программа создает подпроцессы, то следить за их системными вызовами тоже. Лучше использовать этот флаг по умолчанию всегда.</li>\n<li><code class=\"language-text\">-p</code> - присоединиться к уже запущенному процессу, указав его PID, например, <code class=\"language-text\">strace -p 747</code></li>\n<li><code class=\"language-text\">-s</code> - показывать первые N символов для всех выводимых строк (имена файлов строками не считаются), например, <code class=\"language-text\">strace -s 800</code>. Дефолтный размер строк - 32, поэтому лучше указывать побольше.</li>\n<li><code class=\"language-text\">-o</code> - перенаправлять вывод в указанный файл, например, <code class=\"language-text\">strace -o log.txt</code></li>\n</ul>\n<h2>Основные системные вызовы</h2>\n<ul>\n<li><code class=\"language-text\">execve</code> - запуск программы</li>\n<li><code class=\"language-text\">open</code> - открытие файла</li>\n<li><code class=\"language-text\">write</code> - запись в файл</li>\n<li><code class=\"language-text\">sendto</code> - отправка данных по сети</li>\n<li><code class=\"language-text\">recvfrom</code> - получение данных по сети</li>\n<li>сетевая активность может осуществляться и через <code class=\"language-text\">read/write</code></li>\n</ul>\n<h2>Пример</h2>\n<p>Смотрим вызовы SSH-сессии:</p>\n<p><code class=\"language-text\">strace -f -o ssh.txt ssh mybox</code></p>\n<p>Смотрим, какие файлы открывает dropbox (PID, например, 230):</p>\n<p><code class=\"language-text\">strace -f -p 230 -e open</code></p>\n<h1>dstat</h1>\n<p>Показывает, сколько данных посылается по сети/пишется на диск каждую секунду.</p>\n<p>Пример запуска:</p>\n<p><code class=\"language-text\">dstat</code></p>\n<p>Вывод:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--\nusr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw \n  2   1  96   0   0   0| 165k 1183k|   0     0 |   0     0 |2665  4578 \n  6   6  84   4   0   1|   0    12M|  14k 3348B|   0     0 |4468    12k\n  3   5  85   5   0   1|   0    12M|8681B 3348B|   0     0 |4156  9436 \n  4   3  86   7   0   1|   0  7880k|  14k 9010B|   0     0 |4368  9721 q</code></pre></div>\n<ul>\n<li><code class=\"language-text\">usr</code> - потребление CPU пользовательскими процессами</li>\n<li><code class=\"language-text\">sys</code> - потребление CPU системными процессами</li>\n<li><code class=\"language-text\">idl</code> - количество простаивающих (idle) процессов</li>\n<li><code class=\"language-text\">wai</code> - количество ожидающих (wait) процессов</li>\n<li><code class=\"language-text\">hiq</code> - количество аппаратных прерываний (hard interrupt)</li>\n<li><code class=\"language-text\">siq</code> - количество программных прерываний (soft interrupt)</li>\n<li><code class=\"language-text\">read</code> - количество операций записи</li>\n<li><code class=\"language-text\">read</code> - количество операций чтения</li>\n<li><code class=\"language-text\">recv</code> - количество байт, полученных по сети</li>\n<li><code class=\"language-text\">send</code> - количество байт, отправленных по сети</li>\n<li><code class=\"language-text\">in</code> - количество раз, когда данные были скопированы <strong>в</strong> память</li>\n<li><code class=\"language-text\">out</code> - количество раз, когда данные были скопированы <strong>из</strong> памяти</li>\n<li><code class=\"language-text\">int</code> - количество прерываний</li>\n<li><code class=\"language-text\">csw</code> - количество переключений контекста (context switch)</li>\n</ul>\n<p>Дополнительные столбцы по процессам и виртуальной памяти появляютя прииспользовании флага <code class=\"language-text\">--vmstat</code>.</p>\n<p>Пример:</p>\n<p><code class=\"language-text\">dstat --vmstat</code></p>\n<p>Вывод:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">---procs--- ------memory-usage----- ---paging-- -dsk/total- ---system-- ----total-cpu-usage----\nrun blk new| used  buff  cach  free|  in   out | read  writ| int   csw |usr sys idl wai hiq siq\n  0 0.0 6.4|8356M 1474M 7517M  707M|   0     0 | 173k 1238k|2677  4626 |  3   1  96   0   0   0\n1.0   0  69|8357M 1474M 7519M  703M|   0     0 |4096B 4440k|3888  7102 |  2   2  87   8   0   0\n  0 1.0  73|8358M 1474M 7521M  701M|   0     0 |   0  5972k|4442  8457 |  3   2  86   8   0   1\n1.0   0  68|8363M 1475M 7522M  694M|   0     0 |  20k 6068k|4032  7931 |  4   3  86   7   0   1</code></pre></div>\n<p>Здесь добавились столбцы:</p>\n<ul>\n<li><code class=\"language-text\">run</code> - количество работающих процессов</li>\n<li><code class=\"language-text\">blk</code> - количество заблокированных процессов</li>\n<li><code class=\"language-text\">new</code> - количество новых процессов</li>\n<li><code class=\"language-text\">used</code> - количество использованной памяти</li>\n<li><code class=\"language-text\">buff</code> - количество буфферизированной памяти</li>\n<li><code class=\"language-text\">cach</code> - количество закешированной памяти</li>\n<li><code class=\"language-text\">free</code> - количество свободной памяти</li>\n</ul>\n<h2>Флаги</h2>\n<ul>\n<li><code class=\"language-text\">-c</code> - вывод инфы по процессору</li>\n<li><code class=\"language-text\">-d</code> - вывод инфы по диску</li>\n<li><code class=\"language-text\">-n</code> - вывод инфы по сети</li>\n<li><code class=\"language-text\">-g</code> - вывод инфы по пейджингу</li>\n<li><code class=\"language-text\">-y</code> - вывод инфы по системе</li>\n</ul>\n<p>По умолчанию, если не указано никаких флагов, <code class=\"language-text\">dstat</code> запускается с флагами <code class=\"language-text\">cdngy</code>.</p>\n<ul>\n<li><code class=\"language-text\">--top-cpu</code> - вывод процесса, использующего больше всех CPU</li>\n<li><code class=\"language-text\">--top-mem</code> - вывод процесса, потребляющего больше всех памяти</li>\n<li><code class=\"language-text\">--output</code> - вывод в csv файл, например, <code class=\"language-text\">dstat --output out.csv</code></li>\n</ul>\n<h1>tcpdump</h1>\n<p>Позволяет сдампить сетевой трафик в файл, чтобы потом его открыть через <code class=\"language-text\">wireshark</code>.</p>\n<p>Пример:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> tcpdump -i wlan <span class=\"token number\">0</span> <span class=\"token punctuation\">\\</span>\n              src port <span class=\"token number\">80</span> or dst port <span class=\"token number\">80</span> <span class=\"token punctuation\">\\</span>\n              -w port-80-recording.pcap`</code></pre></div>\n<p>А потом открываем результат <code class=\"language-text\">wireshark</code>-ом:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">wireshark port-80-recording.pcap</code></pre></div>\n<p><code class=\"language-text\">wireshark</code> работает на уровне tcp и ничего не знает про http. Если нужно работать с HTTP-трафиком, то может помочь <code class=\"language-text\">tshark</code>, но у меня на дебиане он не запустился.</p>\n<h2>Правила фильтрации</h2>\n<p><a href=\"http://www.tcpdump.org/manpages/pcap-filter.7.html\">http://www.tcpdump.org/manpages/pcap-filter.7.html</a></p>\n<ul>\n<li><code class=\"language-text\">dst port ya.ru</code> - порт назначения = 80 (работает только с ip/tcp, ip/udp, ip6/tcp, ip6/udp)</li>\n<li><code class=\"language-text\">src port ya.ru</code> - порт источника = 80</li>\n<li><code class=\"language-text\">dst host ya.ru</code> - хост назначения = ya.ru</li>\n<li><code class=\"language-text\">src host ya.ru</code> - хост источника = ya.ru</li>\n<li><code class=\"language-text\">host ya.ru</code> - хост назначения или источника = ya.ru</li>\n</ul>\n<p>Перед <code class=\"language-text\">host</code> можно писать <code class=\"language-text\">ip</code>, <code class=\"language-text\">arp</code>, <code class=\"language-text\">rarp</code>, <code class=\"language-text\">ip6</code> для указани протокола, например:</p>\n<p><code class=\"language-text\">ip host ya.ru</code></p>\n<ul>\n<li><code class=\"language-text\">proto protocol</code> - пакет является ip4 или ip6 пакетом указанного протокола (tcp, udp, icmp)</li>\n<li><code class=\"language-text\">tcp, udp, icmp</code> - аббревиатура для <code class=\"language-text\">proto p</code>, где p - протокол</li>\n</ul>\n<h2>Wireshark</h2>\n<p>В wireshark свой язык фильтрации, вот как, например, отфильтровать по ip-адресу источника:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ip.src == 192.168.1.3</code></pre></div>\n<p>Для назначения, соответственно:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ip.dst == 192.168.1.3</code></pre></div>\n<p>Если нужно в обе стороны, то:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ip.src == 192.168.1.3 or ip.dst == 192.168.1.3</code></pre></div>\n<p>либо же воспользоваться алиасом addr:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">ip.addr == 192.168.1.3</code></pre></div>\n<h1>perf</h1>\n<p>Поможет ответить на следующие вопросы:</p>\n<ul>\n<li>почему ядро так грузит процессор?</li>\n<li>какие ветки кода генерят промахи кэша L2?</li>\n<li>сильно ли чтения памяти тормозят процессор?</li>\n<li>какие ветки кода выделяют память и сколько?</li>\n<li>из-за чего происходит переотправка пакетов TCP?</li>\n<li>вызывается ли определенная функция ядра, и как часто?</li>\n<li>по какой причине потоки покидают процессор?</li>\n</ul>\n<h2>Установка</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> linux-tools</code></pre></div>\n<h2>Пример использования</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> perf record -e block:block_rq_issue -ag\n<span class=\"token function\">sudo</span> perf report</code></pre></div>\n<p>1 строчка запускает сбор счетчика <code class=\"language-text\">block:block_rq_issue</code>, который отслеживает обращения к диску. Эта команда ничего не выдает на экран, но в фоне собирает и записывает инфу в файл <code class=\"language-text\">perf.data</code> до тех пор, пока ее не остановим через Ctrl-C.</p>\n<p>2 строчка открывает отчет. Окно интерактивное, можно стрелочками выбрать строку и раскрыть ее (Enter). Кнопка <strong>E</strong> раскрывает все узлы.</p>\n<p>Если в стектрейсах вместо названий функций 16-ричные числа - значит, нужно установить символы отладки для этой программы. Часто их можно установить через <code class=\"language-text\">apt-get</code>, добавив суффикс <code class=\"language-text\">-dbgsym</code>, например: <code class=\"language-text\">libc6-dbgsym</code>.</p>\n<p>При использовании с джавой или NodeJS нужно, чтобы JIT-компилятор писал символы отладки в файл <code class=\"language-text\">/tmp/perf-PID.map</code>. Для джавы это делает <a href=\"https://github.com/jvm-profiling-tools/perf-map-agent\">perf-map-agent</a>, для ноды - флаг <code class=\"language-text\">--perf_basic_prof</code>. <a href=\"http://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html\">Здесь</a> есть инструкции, как их использовать.</p>\n<h2>Полезные команды</h2>\n<p><strong>Трейсить</strong> - собирать инфу по каждому ивенту</p>\n<p><strong>Сэмплить</strong> - собирать инфу по подмножеству ивентов, например один раз на каждые 50 выстрелов</p>\n<p>Эти команды выдают результат в терминал</p>\n<ul>\n<li><code class=\"language-text\">perf stat *command*</code> - статистика процессора при выполнении указанной команды</li>\n<li><code class=\"language-text\">perf stat -d *command*</code> - расширенная статистика</li>\n<li><code class=\"language-text\">perf stat -p *PID*</code> - статистика процессора для указанного процесса, собирается пока не нажато Ctrl-C</li>\n<li><code class=\"language-text\">perf stat -a sleep 5</code> - собирать статистику процессора для всей системы в течение 5 секунд</li>\n<li><code class=\"language-text\">perf stat -e cycles,instructions,cache-references,cache-misses,bus-cycles -a sleep 10</code> - разные статистики процессора для всей системы в течение 10 секунд</li>\n<li><code class=\"language-text\">perf stat -e L1-dcache-loads,L1-dcache-load-misses,L1-dcache-stores *command*</code> - статистики кэша L1 для указанной команды</li>\n<li><code class=\"language-text\">perf stat -e dTLB-loads,dTLB-load-misses,dTLB-prefetch-misses *command*</code> - статистики TLB для указанной команды</li>\n<li><code class=\"language-text\">perf stat -e LLC-loads,LLC-load-misses,LLC-stores,LLC-prefetches **command**</code> - статистики кэша LLC для указанной команды</li>\n<li><code class=\"language-text\">perf stat -e raw_syscalls:sys_enter -I 1000 -a</code> - считать количество сисколлов в секунду для всей системы</li>\n<li><code class=\"language-text\">perf stat -e &#39;syscalls:sys_enter_*&#39; -p **PID**</code> - считать количество сисколлов и группировать их по типу для указанного процесса, пока не будет нажато Ctrl-C</li>\n<li><code class=\"language-text\">perf stat -e &#39;syscalls:sys_enter_*&#39; -a sleep 5</code> - считать количество сисколлов и группировать их по типу для всей системы в течение 5 секунд</li>\n<li><code class=\"language-text\">perf record -e sched:sched_process_exec -a</code> - трейсить все новые процессы до Ctrl-C</li>\n<li><code class=\"language-text\">perf record -e context-switches -a</code> - сэмплить контекст-свитчи до Ctrl-C</li>\n<li><code class=\"language-text\">perf record -e context-switches -c 1 -a</code> - трейсить все контекст-свитчи до Ctrl-C</li>\n<li><code class=\"language-text\">perf probe --add tcp_sendmsg</code> - добавить возможность отслеживания вызовов функции <code class=\"language-text\">tcp_sendmsg</code></li>\n<li><code class=\"language-text\">perf probe -d tcp_sendmsg</code> - удалить возможность отслеживания вызовов функции <code class=\"language-text\">tcp_sendmsg</code></li>\n</ul>\n<h2>Флэйм-графы</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/brendangregg/FlameGraph  <span class=\"token comment\"># or download it from github</span>\n<span class=\"token builtin class-name\">cd</span> FlameGraph\nperf record -F <span class=\"token number\">99</span> -ag -- <span class=\"token function\">sleep</span> <span class=\"token number\">60</span>\nperf script <span class=\"token operator\">|</span> ./stackcollapse-perf.pl <span class=\"token operator\">></span> out.perf-folded\n<span class=\"token function\">cat</span> out.perf-folded <span class=\"token operator\">|</span> ./flamegraph.pl <span class=\"token operator\">></span> perf-kernel.svg</code></pre></div>\n<h1>vmstat</h1>\n<p>Использование:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">vmstat</span> <span class=\"token number\">2</span> <span class=\"token number\">6</span></code></pre></div>\n<p>С такими аргументами статистика использования виртуальной памяти будет показываться каждые 2 секунды 6 раз. Первая строчка всегда дает средние значения с последней перезагрузки. Последующие дают средние значения за время <em>delay</em>, указывающееся первым числовым аргументом.</p>\n<p>Можно выводить статистику по использованию диска: <code class=\"language-text\">vmstat -d 2 6</code>.</p>\n<p>Пример вывода на Debian в режиме VM:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   <span class=\"token function\">free</span>   buff  cache   si   so    bi    bo   <span class=\"token keyword\">in</span>   cs us sy <span class=\"token function\">id</span> wa st\n <span class=\"token number\">1</span>  <span class=\"token number\">0</span> <span class=\"token number\">5866632</span> <span class=\"token number\">302212</span> <span class=\"token number\">1028888</span> <span class=\"token number\">4434828</span>    <span class=\"token number\">0</span>    <span class=\"token number\">1</span>    <span class=\"token number\">13</span>    <span class=\"token number\">61</span>    <span class=\"token number\">2</span>    <span class=\"token number\">2</span>  <span class=\"token number\">3</span>  <span class=\"token number\">2</span> <span class=\"token number\">95</span>  <span class=\"token number\">0</span>  <span class=\"token number\">0</span>\n <span class=\"token number\">0</span>  <span class=\"token number\">0</span> <span class=\"token number\">5866632</span> <span class=\"token number\">291460</span> <span class=\"token number\">1028896</span> <span class=\"token number\">4435540</span>    <span class=\"token number\">0</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>   <span class=\"token number\">220</span> <span class=\"token number\">9818</span> <span class=\"token number\">17977</span>  <span class=\"token number\">4</span>  <span class=\"token number\">2</span> <span class=\"token number\">94</span>  <span class=\"token number\">0</span>  <span class=\"token number\">0</span>\n <span class=\"token number\">6</span>  <span class=\"token number\">0</span> <span class=\"token number\">5866632</span> <span class=\"token number\">293752</span> <span class=\"token number\">1028896</span> <span class=\"token number\">4435996</span>    <span class=\"token number\">0</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>     <span class=\"token number\">0</span> <span class=\"token number\">10499</span> <span class=\"token number\">21794</span>  <span class=\"token number\">8</span>  <span class=\"token number\">4</span> <span class=\"token number\">88</span>  <span class=\"token number\">0</span>  <span class=\"token number\">0</span>\n <span class=\"token number\">0</span>  <span class=\"token number\">0</span> <span class=\"token number\">5866632</span> <span class=\"token number\">290568</span> <span class=\"token number\">1028896</span> <span class=\"token number\">4436376</span>    <span class=\"token number\">0</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>  <span class=\"token number\">2328</span> <span class=\"token number\">10009</span> <span class=\"token number\">18690</span>  <span class=\"token number\">4</span>  <span class=\"token number\">3</span> <span class=\"token number\">93</span>  <span class=\"token number\">0</span>  <span class=\"token number\">0</span>\n <span class=\"token number\">0</span>  <span class=\"token number\">0</span> <span class=\"token number\">5866632</span> <span class=\"token number\">289300</span> <span class=\"token number\">1028912</span> <span class=\"token number\">4436496</span>    <span class=\"token number\">0</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>   <span class=\"token number\">738</span> <span class=\"token number\">9977</span> <span class=\"token number\">18418</span>  <span class=\"token number\">3</span>  <span class=\"token number\">3</span> <span class=\"token number\">95</span>  <span class=\"token number\">0</span>  <span class=\"token number\">0</span>\n <span class=\"token number\">0</span>  <span class=\"token number\">0</span> <span class=\"token number\">5866632</span> <span class=\"token number\">289728</span> <span class=\"token number\">1028924</span> <span class=\"token number\">4436684</span>    <span class=\"token number\">0</span>    <span class=\"token number\">0</span>     <span class=\"token number\">0</span>   <span class=\"token number\">120</span> <span class=\"token number\">10139</span> <span class=\"token number\">19331</span>  <span class=\"token number\">3</span>  <span class=\"token number\">2</span> <span class=\"token number\">95</span>  <span class=\"token number\">0</span>  <span class=\"token number\">0</span></code></pre></div>\n<h2>Описание полей:</h2>\n<h3>Procs</h3>\n<ul>\n<li>r: The number of runnable processes (running or waiting for run time).</li>\n<li>b: The number of processes in uninterruptible sleep.</li>\n</ul>\n<h3>Memory</h3>\n<ul>\n<li>swpd: the amount of virtual memory used.</li>\n<li>free: the amount of idle memory.</li>\n<li>buff: the amount of memory used as buffers.</li>\n<li>cache: the amount of memory used as cache.</li>\n<li>inact: the amount of inactive memory.  (-a option)</li>\n<li>active: the amount of active memory.  (-a option)</li>\n</ul>\n<h3>Swap</h3>\n<ul>\n<li>si: Amount of memory swapped in from disk (/s).</li>\n<li>so: Amount of memory swapped to disk (/s).</li>\n</ul>\n<h3>IO</h3>\n<ul>\n<li>bi: Blocks received from a block device (blocks/s).</li>\n<li>bo: Blocks sent to a block device (blocks/s).</li>\n</ul>\n<h3>System</h3>\n<ul>\n<li>in: The number of interrupts per second, including the clock.</li>\n<li>cs: The number of context switches per second.</li>\n</ul>\n<h3>CPU</h3>\n<p>These are percentages of total CPU time.</p>\n<ul>\n<li>us: Time spent running non-kernel code.  (user time, including nice time)</li>\n<li>sy: Time spent running kernel code.  (system time)</li>\n<li>id: Time spent idle.  Prior to Linux 2.5.41, this includes IO-wait time.</li>\n<li>wa: Time spent waiting for IO.  Prior to Linux 2.5.41, included in idle.</li>\n<li>st: Time stolen from a virtual machine.  Prior to Linux 2.6.11, unknown.</li>\n</ul>\n<h2>Дисковый режим</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">vmstat</span> -d <span class=\"token number\">1</span> <span class=\"token number\">1</span></code></pre></div>\n<p>Результат:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">disk- ------------reads------------ ------------writes----------- -----IO------\n       total merged sectors      ms  total merged sectors      ms    cur    sec\nsda   4875777 1816309 473984778 5311008 18301794 32203707 2244809614 197933460      0  18362\ndm-0  4802238      0 458568874 6456436 43560867      0 2203748144 777588792      0  17997\ndm-1  1908554      0 15272184 2384716 5123066      0 40984528 200874876      0   1287\nloop0 227474      0  457018   57800      0      0       0       0      0      2\nloop1    535      0    3100      76      0      0       0       0      0      0\nloop2    538      0    3102      68      0      0       0       0      0      0\nloop3     33      0     120       0      0      0       0       0      0      0\nloop4      0      0       0       0      0      0       0       0      0      0\nloop5      0      0       0       0      0      0       0       0      0      0\nloop6      0      0       0       0      0      0       0       0      0      0\nloop7      0      0       0       0      0      0       0       0      0      0</code></pre></div>\n<h2>Описание полей</h2>\n<h3>Reads</h3>\n<ul>\n<li>total: Total reads completed successfully</li>\n<li>merged: grouped reads (resulting in one I/O)</li>\n<li>sectors: Sectors read successfully</li>\n<li>ms: milliseconds spent reading</li>\n</ul>\n<h3>Writes</h3>\n<ul>\n<li>total: Total writes completed successfully</li>\n<li>merged: grouped writes (resulting in one I/O)</li>\n<li>sectors: Sectors written successfully</li>\n<li>ms: milliseconds spent writing</li>\n</ul>\n<h3>IO</h3>\n<ul>\n<li>cur: I/O in progress</li>\n<li>s: seconds spent for I/O</li>\n</ul>","frontmatter":{"path":"/blog/linux-debugging","title":"Linux debugging"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}