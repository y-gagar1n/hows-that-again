{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/linux-networking","webpackCompilationHash":"042a161784811b76df9c","result":{"data":{"markdownRemark":{"html":"<p>Источник: <a href=\"http://linux-ip.net/html/index.html\">http://linux-ip.net/html/index.html</a></p>\n<h1>route</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>root@morgan<span class=\"token punctuation\">]</span><span class=\"token comment\"># route -n</span>\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n<span class=\"token number\">192.168</span>.98.0    <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0\n<span class=\"token number\">127.0</span>.0.0       <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.0</span>.0.0       U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> lo\n<span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">192.168</span>.98.254  <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0</code></pre></div>\n<p>Первая строчка вывода <code class=\"language-text\">route -n</code> означает, что все адреса из диапазона <code class=\"language-text\">192.168.98.0/24</code> достижимы напрямую.\nВторая строчка это стандартный маршрут для loopback-интерфейса, означает что все адреса, начинающиеся со 127, будут попадать на локалхост.\nТретья строчка означает, что все остальные адреса должны проходить через шлюз <code class=\"language-text\">192.168.98.254</code>.</p>\n<p><code class=\"language-text\">0.0.0.0</code> в колонке <code class=\"language-text\">Gateway</code> означает, что мы будем обращаться к устройству напрямую, любое дргуое значение - что через роутер (такие маршруты обязательно должны содержать <strong>G</strong> в колонке <code class=\"language-text\">Flags</code>).</p>\n<h2>Добавление маршрута до сети</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>root@masq-gw<span class=\"token punctuation\">]</span><span class=\"token comment\"># route add -net 10.38.0.0 netmask 255.255.0.0 gw 192.168.100.1</span></code></pre></div>\n<h2>Добавление машрута до конкретного узла</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>root@tristan<span class=\"token punctuation\">]</span><span class=\"token comment\"># route add -host 192.168.98.101 gw 192.168.99.1</span>\n<span class=\"token punctuation\">[</span>root@tristan<span class=\"token punctuation\">]</span><span class=\"token comment\"># route -n</span>\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n<span class=\"token number\">192.168</span>.98.101  <span class=\"token number\">192.168</span>.99.1    <span class=\"token number\">255.255</span>.255.255 UG    <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0\n<span class=\"token number\">192.168</span>.99.0    <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0\n<span class=\"token number\">127.0</span>.0.0       <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.0</span>.0.0       U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> lo\n<span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">192.168</span>.99.254  <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0</code></pre></div>\n<h2>Добавление дефолтного шлюза</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>root@tristan<span class=\"token punctuation\">]</span><span class=\"token comment\"># route add default gw 192.168.99.254</span></code></pre></div>\n<h2>Удаление маршрутов</h2>\n<p>Удаление осуществляется командой <code class=\"language-text\">route del</code> с теми же аргументами, что и при добавлении.</p>\n<h1>arp</h1>\n<p>Утилита для манипуляций с ARP-таблицей. В этой таблице хранятся соответствия mac-адресов ip-адресам.</p>\n<p>Вывод всех записей для конкретного интерфейса:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>root@masq-gw<span class=\"token punctuation\">]</span><span class=\"token comment\"># arp -ni eth3</span>\nAddress                  HWtype  HWaddress           Flags Mask Iface\n<span class=\"token number\">192.168</span>.100.1           ether   00:C0:7B:7D:00:C8   C    </code></pre></div>\n<p>При помощи техники <code class=\"language-text\">Proxy ARP</code> можно разделить сеть на 2 части, которые смогут общаться между собой только через роутер.</p>\n<p>Атака <code class=\"language-text\">ARP Spoofing</code> позволяет человеку-по-середине отправлять в сеть ARP-ответы, где он произвольным ip-адресам сопоставляет свой MAC-адрес, в результате чего запросы на этот ip будут отправляться ему.</p>\n<h2>Прослушивание ARP-запросов в сети</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[root@masq-gw]# tcpdump -ennqti eth0 \\( arp or icmp \\)\ntcpdump: listening on eth0\n0:80:c8:f8:4a:51 ff:ff:ff:ff:ff:ff 42: arp who-has 192.168.99.254 tell 192.168.99.35             \n0:80:c8:f8:5c:73 0:80:c8:f8:4a:51 60: arp reply 192.168.99.254 is-at 0:80:c8:f8:5c:73            \n0:80:c8:f8:4a:51 0:80:c8:f8:5c:73 98: 192.168.99.35 &gt; 192.168.99.254: icmp: echo request (DF)    \n0:80:c8:f8:5c:73 0:80:c8:f8:4a:51 98: 192.168.99.254 &gt; 192.168.99.35: icmp: echo reply           </code></pre></div>\n<p>В первой строчке мы видим, что хост с mac-адресом <code class=\"language-text\">0:80:c8:f8:4a:51</code> отправил щироковещательный (<code class=\"language-text\">ff:ff:ff:ff:ff:ff</code>) запрос, в котором спрашивает, знает ли кто-нибудь MAC-адрес, соответствующий ip-адресу <code class=\"language-text\">192.168.99.254</code> и просит отправить ответ на адрес <code class=\"language-text\">192.168.99.35</code>. </p>\n<p>Во второй строчке хост с адресом <code class=\"language-text\">0:80:c8:f8:5c:73</code> отвечает ему, что искомый ip находится на машине с адресом <code class=\"language-text\">0:80:c8:f8:5c:73</code>.</p>\n<p>В 3 и 4 строчках эти машины обмениваются ICMP-запросом.</p>\n<h2>arping</h2>\n<p>Позволяет отправить arp-запрос в сеть:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>root@masq-gw<span class=\"token punctuation\">]</span><span class=\"token comment\"># arping -I eth0 -c 2 192.168.100.17</span>\nARPING <span class=\"token number\">192.168</span>.100.17 from <span class=\"token number\">192.168</span>.100.254 eth0\nUnicast reply from <span class=\"token number\">192.168</span>.100.17 <span class=\"token punctuation\">[</span>00:80:C8:E8:4B:8E<span class=\"token punctuation\">]</span>  <span class=\"token number\">8</span>.419ms\nUnicast reply from <span class=\"token number\">192.168</span>.100.17 <span class=\"token punctuation\">[</span>00:80:C8:E8:4B:8E<span class=\"token punctuation\">]</span>  <span class=\"token number\">2</span>.095ms\nSent <span class=\"token number\">2</span> probes <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> broadcast<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">))</span>\nReceived <span class=\"token number\">2</span> response<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></code></pre></div>\n<h1>Перенос машины в другую сеть</h1>\n<p>Допустим, у нас есть машина <code class=\"language-text\">morgan</code> в сети <code class=\"language-text\">192.168.98.0/24</code> и мы хотим перенести ее в сеть <code class=\"language-text\">192.168.99.0/24</code>.</p>\n<p>Вот некоторые исходные данные:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>root@morgan<span class=\"token punctuation\">]</span><span class=\"token comment\"># ifconfig eth0</span>\neth0      Link encap:Ethernet  HWaddr 00:80:C8:F8:4A:53  \n          inet addr:192.168.98.82  Bcast:192.168.98.255  Mask:255.255.255.0\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:100 \n          RX bytes:0 <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> b<span class=\"token punctuation\">)</span>  TX bytes:0 <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> b<span class=\"token punctuation\">)</span>\n          Interrupt:9 Base address:0x5000 \n\n<span class=\"token punctuation\">[</span>root@morgan<span class=\"token punctuation\">]</span><span class=\"token comment\"># route -n</span>\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n<span class=\"token number\">192.168</span>.98.0    <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0\n<span class=\"token number\">127.0</span>.0.0       <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.0</span>.0.0       U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> lo\n<span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">192.168</span>.98.254  <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0</code></pre></div>\n<p>Чтобы подключить машину в другую сеть,нужно:</p>\n<ol>\n<li>Отключить сетевой интерфейс</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>root@morgan<span class=\"token punctuation\">]</span><span class=\"token comment\"># ifconfig eth0 down</span></code></pre></div>\n<p>После отключения сетевого интерфейса из таблицы маршрутов <strong>удаляются</strong> все маршруты, проходящие через этот интерфейс.</p>\n<ol start=\"2\">\n<li>Включить его заново с новым ip</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[root@morgan]# ifconfig eth0 192.168.99.14 netmask 255.255.255.0 up\n[root@morgan]# ifconfig eth0\neth0      Link encap:Ethernet  HWaddr 00:80:C8:F8:4A:53  \n          inet addr:192.168.99.14  Bcast:192.168.99.255  Mask:255.255.255.0\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:100 \n          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)\n          Interrupt:9 Base address:0x5000 \n[root@morgan]# route -n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n192.168.99.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0\n127.0.0.0       0.0.0.0         255.0.0.0       U     0      0        0 lo</code></pre></div>\n<p>После поднятия сетевого интерфейса в таблицу маршрутов добавляются маршруты, соответствующие настроенному ip (первая строка в выводе <code class=\"language-text\">route -n</code>). Пока мы не знаем, кто шлюз, считаем шлюзом себя, то есть <code class=\"language-text\">0.0.0.0</code></p>\n<ol start=\"3\">\n<li>Добавить дефолтный путь, проходящий через шлюз</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>root@morgan<span class=\"token punctuation\">]</span><span class=\"token comment\"># route add default gw 192.168.99.254</span>\n<span class=\"token punctuation\">[</span>root@morgan<span class=\"token punctuation\">]</span><span class=\"token comment\"># route -n</span>\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n<span class=\"token number\">192.168</span>.99.0    <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.255</span>.255.0   U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0\n<span class=\"token number\">127.0</span>.0.0       <span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">255.0</span>.0.0       U     <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> lo\n<span class=\"token number\">0.0</span>.0.0         <span class=\"token number\">192.168</span>.99.254  <span class=\"token number\">0.0</span>.0.0         UG    <span class=\"token number\">0</span>      <span class=\"token number\">0</span>        <span class=\"token number\">0</span> eth0</code></pre></div>","frontmatter":{"path":"/blog/linux-networking","title":"Linux networking"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}