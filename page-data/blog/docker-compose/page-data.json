{"componentChunkName":"component---src-templates-blog-template-js","path":"/blog/docker-compose","result":{"data":{"markdownRemark":{"html":"<h1 id=\"docker-compose\" style=\"position:relative;\"><a href=\"#docker-compose\" aria-label=\"docker compose permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Compose</h1>\n<p><a href=\"https://docs.docker.com/compose/gettingstarted/\">https://docs.docker.com/compose/gettingstarted/</a></p>\n<p><a href=\"https://docs.docker.com/compose/compose-file/\">https://docs.docker.com/compose/compose-file/</a></p>\n<p>Позволяет управлять приложениями, которые используют функциональность нескольких контайнеров сразу.</p>\n<h2 id=\"создаем-yaml-файл\" style=\"position:relative;\"><a href=\"#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%B5%D0%BC-yaml-%D1%84%D0%B0%D0%B9%D0%BB\" aria-label=\"создаем yaml файл permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Создаем YAML-файл</h2>\n<p><strong>C:/tutorial/docker-compose.yml</strong> </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">version: &#39;2&#39;\n\nservices:\ntarantool:\ncontainer_name: mytarantool\nimage: tarantool/tarantool:1.7\ncommand: tarantool /usr/local/share/tarantool/app.init.lua\nports:\n  - 3301:3301\nvolumes:\n  - c:/tarantool/app:/usr/local/share/tarantool\n  - c:/tarantool/data:/var/lib/tarantool</code></pre></div>\n<p>Если не указан <code class=\"language-text\">container_name</code>, то будет использоваться одноименный с сервисом, т.е. в этом случае - tarantool.</p>\n<p>Если в сервисе указать <code class=\"language-text\">build: .</code> - это означает искать Dockerfile в той же директории, что и compose-файл. Тогда он попытается сбилдится. (При установке kafka было такое, что из-за windows почему-то не мог сбилдиться докерфайл, пришлось заменить build на Image и использовать готовый)</p>\n<p><strong>ports</strong> - маппинг портов. Первый идет порт хоста, второй - порт контейнера.</p>\n<p><strong>volumes</strong> - маунт директорий хоста на директории контейнера. Сначала директория хоста, потом - контейнера.</p>\n<p><strong>environment</strong> - переменные среды</p>\n<h2 id=\"создание-и-запуск-контейнера\" style=\"position:relative;\"><a href=\"#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B8-%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0\" aria-label=\"создание и запуск контейнера permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Создание и запуск контейнера</h2>\n<p><code class=\"language-text\">docker-compose -f C:/tutorial/docker-compose.yml up -d</code></p>\n<p>При этом будут остановлены входящие контейнеры, а потом созданы и запущены заново.</p>\n<p><strong>-f</strong> - путь к compose-файлу </p>\n<p><strong>up</strong> - команда \"создать и стартовать контейнер\"</p>\n<p><strong>-d</strong> - аналогично detach в docker, стартовать в фоне</p>\n<p>После этого желательно проверить запущенные контейнеры: <code class=\"language-text\">docker-compose ps</code></p>\n<p>Если какой-то из контейнеров не запустился, то можно попробовать поднять еще раз, но без -d, и искать ошибки в логах: <code class=\"language-text\">docker-compose up</code></p>\n<p>Можно поднять только некоторые сервисы: <code class=\"language-text\">docker-compose up service1</code></p>\n<p>При этом зависимости будут подняты автоматически.</p>\n<p>Чтобы зависимости не останавливались, не перестраивались и не поднимались, можно указать флаг <strong>--no-dep</strong></p>\n<h2 id=\"остановка-и-удаление\" style=\"position:relative;\"><a href=\"#%D0%BE%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B8-%D1%83%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5\" aria-label=\"остановка и удаление permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Остановка и удаление</h2>\n<p><code class=\"language-text\">docker-compose -f C:/tarantool/docker-compose.yml down</code></p>\n<p>Чтобы удалить все волюмы, созданные этим компоузом на диске хоста, нужно указать флаг <code class=\"language-text\">--v</code>:</p>\n<p><code class=\"language-text\">docker-compose down --v</code></p>\n<h2 id=\"логи\" style=\"position:relative;\"><a href=\"#%D0%BB%D0%BE%D0%B3%D0%B8\" aria-label=\"логи permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Логи</h2>\n<p><code class=\"language-text\">docker-compose logs service1 service2</code> - выдаст аггрегированный лог с этих двух сервисов</p>\n<h2 id=\"построение-образов\" style=\"position:relative;\"><a href=\"#%D0%BF%D0%BE%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2\" aria-label=\"построение образов permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Построение образов</h2>\n<p><code class=\"language-text\">docker-compose build</code></p>\n<h2 id=\"скачивание-образов\" style=\"position:relative;\"><a href=\"#%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2\" aria-label=\"скачивание образов permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Скачивание образов</h2>\n<p><code class=\"language-text\">docker-compose pull</code></p>\n<h2 id=\"масштабирование\" style=\"position:relative;\"><a href=\"#%D0%BC%D0%B0%D1%81%D1%88%D1%82%D0%B0%D0%B1%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5\" aria-label=\"масштабирование permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Масштабирование</h2>\n<p><code class=\"language-text\">docker-compose up --scale service1=5</code> - запустит 4 дополнительных контейнера</p>\n<h2 id=\"рестарт-контейнера\" style=\"position:relative;\"><a href=\"#%D1%80%D0%B5%D1%81%D1%82%D0%B0%D1%80%D1%82-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%B9%D0%BD%D0%B5%D1%80%D0%B0\" aria-label=\"рестарт контейнера permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Рестарт контейнера</h2>\n<p><code class=\"language-text\">docker-compose -f C:/tarantool/docker-compose.yml restart</code></p>\n<h2 id=\"остановка-сервиса\" style=\"position:relative;\"><a href=\"#%D0%BE%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0\" aria-label=\"остановка сервиса permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Остановка сервиса</h2>\n<p><code class=\"language-text\">docker-compose stop kafka</code> - остановятся все контейнеры, принадлежащие службе kafka</p>\n<p>То есть если мы запускали с параметром <code class=\"language-text\">--scale kafka=5</code>, то остановятся все 5.</p>\n<p>Если нужно остановить какой-то один, то можем сделать <code class=\"language-text\">docker stop &lt;id контейнера&gt;</code>, а <strong>id</strong> посмотреть через <code class=\"language-text\">docker ps</code></p>\n<p>А вот как завести какой-то один - не понятно, можно конечно через <code class=\"language-text\">docker run</code>, но если в <strong>docker-compose.yml</strong> прописаны какие-то специальные параметры запуска, и мы их не укажем, то может и не стартануть. </p>\n<p>Поэтому на данный момент известен только один выход: <code class=\"language-text\">docker start kafka</code> - все остановленные контейнеры службы <strong>kafka</strong> перезапустятся.</p>\n<h2 id=\"пример-compose-файла-для-kafka-с-3-брокерами\" style=\"position:relative;\"><a href=\"#%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80-compose-%D1%84%D0%B0%D0%B9%D0%BB%D0%B0-%D0%B4%D0%BB%D1%8F-kafka-%D1%81-3-%D0%B1%D1%80%D0%BE%D0%BA%D0%B5%D1%80%D0%B0%D0%BC%D0%B8\" aria-label=\"пример compose файла для kafka с 3 брокерами permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Пример compose-файла для Kafka с 3 брокерами</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">version: &#39;2&#39; \nservices: \n\tzookeeper: \n\t\timage: wurstmeister/zookeeper \n\t\tports: \n\t\t\t- &quot;2181:2181&quot; \n\tkafka0: \n\t\timage: wurstmeister/kafka \n\t\tports: \n\t\t\t- &quot;9092:9092&quot;\n\t\tenvironment: \n\t\t\tKAFKA_ADVERTISED_HOST_NAME: 192.168.1.65\n\t\t\tKAFKA_ZOOKEEPER_CONNECT: zookeeper:2181\n\t\tvolumes:\n\t\t\t- /var/run/docker.sock:/var/run/docker.sock\n\tkafka1: \n\t\timage: wurstmeister/kafka \n\t\tports: \n\t\t\t- &quot;9093:9092&quot;\n\t\tenvironment: \n\t\t\tKAFKA_ADVERTISED_HOST_NAME: 192.168.1.65\n\t\t\tKAFKA_ZOOKEEPER_CONNECT: zookeeper:2181\n\t\tvolumes:\n\t\t\t- /var/run/docker.sock:/var/run/docker.sock\n\tkafka2: \n\t\timage: wurstmeister/kafka \n\t\tports: \n\t\t\t- &quot;9094:9092&quot;\n\t\tenvironment: \n\t\t\tKAFKA_ADVERTISED_HOST_NAME: 192.168.1.65\n\t\t\tKAFKA_ZOOKEEPER_CONNECT: zookeeper:2181\n\t\tvolumes:\n\t\t\t- /var/run/docker.sock:/var/run/docker.sock</code></pre></div>","frontmatter":{"path":"/blog/docker-compose","title":"Docker Compose"}}},"pageContext":{}},"staticQueryHashes":["3649515864"]}