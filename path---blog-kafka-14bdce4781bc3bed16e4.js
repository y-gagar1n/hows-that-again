webpackJsonp([0xd0f4f4520238],{426:function(e,o){e.exports={data:{markdownRemark:{html:'<h1>Kafka</h1>\n<h2>Установка</h2>\n<p>Проще всего установить через Docker</p>\n<p>Образ: wurstmeister/kafka</p>\n<p>Запускается через docker-compose,брать с гитхаба этого докерфайла</p>\n<p>После установки все .sh скрипты лежат по адресу <code>/opt/kafka/bin</code>, либо <code>$KAFKA_HOME/bin</code></p>\n<p>Дальнейшие инструкции описаны в соответствии с этим способом установки</p>\n<h2>Вывод всех топиков:</h2>\n<pre><code class="language-shell">$KAFKA_HOME/bin/kafka-topics.sh --list --zookeeper zookeeper:2181\n</code></pre>\n<h2>Создание топика:</h2>\n<pre><code>$KAFKA_HOME/bin/kafka-topics.sh --create --zookeeper zookeeper:2181 --replication-factor 3 --partitions 1 --topic my-replicated-topic\n</code></pre>\n<h2>Вывод информации о состоянии кластера:</h2>\n<p><code>bash-4.3# $KAFKA_HOME/bin/kafka-topics.sh --describe --zookeeper zookeeper:2181** **Topic:my-replicated-topic PartitionCount:1 ReplicationFactor:3 Configs:** ** Topic: my-replicated-topic Partition: 0 Leader: 1004 Replicas: 1004,1003,1005 Isr: 1004,1003,1005</code></p>\n<p>1003,1004,1005 - это id брокеров</p>\n<p><code>leader</code> - ответственный за все записи и чтения в партишне</p>\n<p><code>replicas</code> - реплики, перечисляются независимо от того, живы они сейчас или нет</p>\n<p><code>isr</code> - in-sync-replicas, т.е. реплики, которые сейчас живы и имеют последнюю версию</p>\n<h2>Паблиш сообщений через консоль:</h2>\n<pre><code>$KAFKA_HOME/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic my-replicated-topic\ntest message 1\ntest message 2\n</code></pre>\n<h2>Консюм сообщений и вывод их в консоль:</h2>\n<p><code>$KAFKA_HOME/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --from-beginning --topic my-replicated-topic</code></p>\n<h2>Вывод id всех брокеров:</h2>\n<p><code>bash-4.3# $KAFKA_HOME/bin/zookeeper-shell.sh zookeeper:2181 ls /brokers/ids</code></p>\n<h2>Вывод инфы по id конкретного брокера:</h2>\n<p><code>bash-4.3# $KAFKA_HOME/bin/zookeeper-shell.sh zookeeper:2181 get /brokers/id/1004</code></p>\n<h2>Возможные проблемы</h2>\n<h3>После перезапуска брокеров клиенты валятся с по таймауту</h3>\n<p>Так может происходить из-за того, что после перезапуска брокерам назначились новые ID, а партишны в зукипере остались назначенными на старых. Самое простое решение - брокерам задавать id на старте, чтобы каждый раз был один и тот же. Либо можно вручную ребалансить партишны после перезапуска брокеров</p>\n<h3>После падения одного брокера продюсер начал выдавать ошибки</h3>\n<p>Наверно replication.factor стоял 1, это значение по умолчанию. Он задается либо при создании топика, либо как default.replication.factor при запуске брокера.</p>\n<p>А еще должен быть <code>auto.leader.rebalance.enable</code> установлен в <code>true</code>? но это и так значение по умолчанию.</p>\n<p>А еще <code>leader.imbalance.check.interval.seconds</code> указывает интервал проверки на необходимость ребаланса, по дефолту 300.</p>\n<p>А еще <code>leader.imbalance.per.broker.percentage</code> указываем максимум нагрузки на одного брокера, после которого начинается ребалансировка. Дефолт - 10%.</p>\n<h3>После подключения новых брокеров им не назначаются автоматически партишны</h3>\n<p>Ага, так и задумано by-design, и ничего с этим не поделать. Только вручную назначать. Автоматически новым брокерам могут быть назначены только партишны новых топиков.</p>',frontmatter:{path:"/blog/kafka",title:"Kafka"}}},pathContext:{}}}});
//# sourceMappingURL=path---blog-kafka-14bdce4781bc3bed16e4.js.map